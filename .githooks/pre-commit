#!/usr/bin/env bash
set -euo pipefail

STAGED_GO_FILES=$(git diff --cached --name-only | grep '\.go$' | tr '\n' ' ' || true)

if [[ -n "${STAGED_GO_FILES}" ]]; then
    make verify files="${STAGED_GO_FILES}"
fi

STAGED_TF_FILES=$(git diff --cached --name-only | grep '\.tf$' || true)
if [[ -n "${STAGED_TF_FILES}" ]]; then
    echo "Checking the format of Terraform files"
    make tflint
fi
