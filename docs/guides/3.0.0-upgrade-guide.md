---
layout: "mongodbatlas"
page_title: "Upgrade Guide 3.0.0"
description: |-
MongoDB Atlas Provider 3.0.0: Upgrade and Information Guide
---

# MongoDB Atlas Provider 3.0.0: Upgrade and Information Guide

The Terraform MongoDB Atlas Provider version 3.0.0 introduces breaking changes to the `mongodbatlas_advanced_cluster` resource and data sources. This guide explains what has changed and how to migrate your configurations.

## Breaking Changes

### `mongodbatlas_advanced_cluster` Resource

#### Removed Attributes

The following attributes have been removed from the resource:

- **`use_effective_fields`** - This attribute is no longer needed. The resource now always stores user-configured values in `replication_specs`.

#### Schema Changes

The following attributes in `replication_specs.region_configs` are now **Optional only** (no longer Computed):

- `auto_scaling`
- `analytics_auto_scaling`
- `electable_specs`
- `read_only_specs`
- `analytics_specs`

This means:
- The resource state only stores values you explicitly configure
- If you don't configure an attribute, it won't appear in state
- Auto-scaling changes made by Atlas won't modify your stored configuration

### `mongodbatlas_advanced_cluster` Data Sources

#### Removed Attributes

The following attributes have been removed from the data sources:

- **`use_effective_fields`** - No longer needed
- **`effective_electable_specs`** - Replaced by `effective_replication_specs`
- **`effective_read_only_specs`** - Replaced by `effective_replication_specs`
- **`effective_analytics_specs`** - Replaced by `effective_replication_specs`

#### New Attribute

- **`effective_replication_specs`** - A new top-level Computed attribute that contains the actual running configuration as computed by Atlas. This has the same structure as `replication_specs` but shows effective values.

## Critical Migration Warning

~> **Warning:** If you previously removed `read_only_specs` or `analytics_specs` from your configuration while using provider version 2.x, those specs were retained in the Terraform state (due to the Computed attribute behavior). **In version 3.0.0, they will be deleted from your cluster** because the resource now only manages what you explicitly configure.

Before upgrading, review your clusters in the Atlas UI to identify any specs that exist on the cluster but are not in your Terraform configuration. Add them to your configuration before upgrading, or accept that they will be removed.

## Migration Steps

### Step 1: Review Current State

Before upgrading, run `terraform plan` with your current provider version to ensure your state is in sync.

### Step 2: Update Your Configuration

1. **Remove `use_effective_fields`** from all `mongodbatlas_advanced_cluster` resources and data sources:

   ```hcl
   # Before (v2.x)
   resource "mongodbatlas_advanced_cluster" "example" {
     project_id         = var.project_id
     name               = "example"
     use_effective_fields = true  # Remove this line
     # ...
   }

   # After (v3.0.0)
   resource "mongodbatlas_advanced_cluster" "example" {
     project_id = var.project_id
     name       = "example"
     # ...
   }
   ```

2. **Add any missing specs** that exist on your cluster but not in your configuration (see warning above).

3. **Update data source references** from `effective_*_specs` to `effective_replication_specs`:

   ```hcl
   # Before (v2.x)
   data "mongodbatlas_advanced_cluster" "example" {
     project_id         = var.project_id
     name               = "example"
     use_effective_fields = true
   }

   output "effective_instance_size" {
     value = data.mongodbatlas_advanced_cluster.example.replication_specs[0].region_configs[0].effective_electable_specs.instance_size
   }

   # After (v3.0.0)
   data "mongodbatlas_advanced_cluster" "example" {
     project_id = var.project_id
     name       = "example"
   }

   output "effective_instance_size" {
     value = data.mongodbatlas_advanced_cluster.example.effective_replication_specs[0].region_configs[0].electable_specs.instance_size
   }
   ```

### Step 3: Upgrade Provider

Update your provider version constraint:

```hcl
terraform {
  required_providers {
    mongodbatlas = {
      source  = "mongodb/mongodbatlas"
      version = ">= 3.0.0"
    }
  }
}
```

### Step 4: Run Terraform Plan

Run `terraform plan` and carefully review any changes. The state upgrade will automatically migrate your state to the new schema version.

## New Behavior Summary

| Aspect | v2.x Behavior | v3.0.0 Behavior |
|--------|---------------|-----------------|
| Resource `replication_specs` | Could be Optional+Computed with `use_effective_fields` | Always Optional only |
| Data source effective values | `effective_*_specs` in region_configs | `effective_replication_specs` at top level |
| Auto-scaling changes | Could be reflected in state | Only in `effective_replication_specs` (data source) |
| Removed specs in config | Retained in state | Deleted from cluster |

## Example: Complete Migration

### Before (v2.x)

```hcl
resource "mongodbatlas_advanced_cluster" "example" {
  project_id         = var.project_id
  name               = "example"
  cluster_type       = "REPLICASET"
  use_effective_fields = true

  replication_specs = [
    {
      region_configs = [
        {
          priority      = 7
          provider_name = "AWS"
          region_name   = "US_EAST_1"
          electable_specs = {
            node_count    = 3
            instance_size = "M10"
          }
          auto_scaling = {
            compute_enabled           = true
            compute_max_instance_size = "M40"
          }
        }
      ]
    }
  ]
}

data "mongodbatlas_advanced_cluster" "example" {
  project_id         = mongodbatlas_advanced_cluster.example.project_id
  name               = mongodbatlas_advanced_cluster.example.name
  use_effective_fields = true
}

output "current_instance_size" {
  value = data.mongodbatlas_advanced_cluster.example.replication_specs[0].region_configs[0].effective_electable_specs.instance_size
}
```

### After (v3.0.0)

```hcl
resource "mongodbatlas_advanced_cluster" "example" {
  project_id   = var.project_id
  name         = "example"
  cluster_type = "REPLICASET"

  replication_specs = [
    {
      region_configs = [
        {
          priority      = 7
          provider_name = "AWS"
          region_name   = "US_EAST_1"
          electable_specs = {
            node_count    = 3
            instance_size = "M10"
          }
          auto_scaling = {
            compute_enabled           = true
            compute_max_instance_size = "M40"
          }
        }
      ]
    }
  ]
}

data "mongodbatlas_advanced_cluster" "example" {
  project_id = mongodbatlas_advanced_cluster.example.project_id
  name       = mongodbatlas_advanced_cluster.example.name
}

# User-configured instance size (what you specified)
output "configured_instance_size" {
  value = data.mongodbatlas_advanced_cluster.example.replication_specs[0].region_configs[0].electable_specs.instance_size
}

# Actual running instance size (may differ due to auto-scaling)
output "effective_instance_size" {
  value = data.mongodbatlas_advanced_cluster.example.effective_replication_specs[0].region_configs[0].electable_specs.instance_size
}
```

## Additional Schema Changes: bi_connector_config and advanced_configuration

### bi_connector_config

The `bi_connector_config` attribute is now **Optional only** (no longer Optional+Computed):

- If you don't configure this block, it won't appear in state
- Atlas still applies its default BI Connector settings server-side
- To see actual values, use the data source

**Before (v2.x):** State contained Atlas defaults even if you didn't configure `bi_connector_config`

**After (v3.0.0):** State only contains what you explicitly configured

### advanced_configuration

The `advanced_configuration` attribute is now **Optional only** (no longer Optional+Computed):

All 14 child attributes are affected:
- `change_stream_options_pre_and_post_images_expire_after_seconds`
- `default_write_concern`
- `javascript_enabled`
- `minimum_enabled_tls_protocol`
- `no_table_scan`
- `oplog_min_retention_hours`
- `oplog_size_mb`
- `sample_refresh_interval_bi_connector`
- `sample_size_bi_connector`
- `transaction_lifetime_limit_seconds`
- `default_max_time_ms`
- `custom_openssl_cipher_config_tls12`
- `custom_openssl_cipher_config_tls13`
- `tls_cipher_config_mode`

This means:
- If you don't configure this block, it won't appear in state
- Atlas still applies its default advanced configuration server-side
- To see actual values, use the data source

### Querying Actual Values via Data Source

Since `bi_connector_config` and `advanced_configuration` are now Optional only on the resource, use the data source to query actual values from Atlas:

```hcl
# Resource - only configure what you need
resource "mongodbatlas_advanced_cluster" "example" {
  project_id   = var.project_id
  name         = "example"
  cluster_type = "REPLICASET"

  replication_specs = [
    {
      region_configs = [
        {
          priority      = 7
          provider_name = "AWS"
          region_name   = "US_EAST_1"
          electable_specs = {
            node_count    = 3
            instance_size = "M10"
          }
        }
      ]
    }
  ]

  # bi_connector_config not specified - won't be in state
  # advanced_configuration not specified - won't be in state
}

# Data source - shows actual Atlas values
data "mongodbatlas_advanced_cluster" "example" {
  project_id = mongodbatlas_advanced_cluster.example.project_id
  name       = mongodbatlas_advanced_cluster.example.name
}

# Access actual BI connector settings from Atlas
output "bi_connector_enabled" {
  value = data.mongodbatlas_advanced_cluster.example.bi_connector_config.enabled
}

# Access actual advanced configuration from Atlas
output "javascript_enabled" {
  value = data.mongodbatlas_advanced_cluster.example.advanced_configuration.javascript_enabled
}
```

## Additional Optional-only Attributes

The following attributes are also now **Optional only** (previously Optional+Computed):

- `backup_enabled`
- `config_server_management_mode`
- `encryption_at_rest_provider`
- `global_cluster_self_managed_sharding`
- `mongo_db_major_version`
- `paused`
- `pit_enabled`
- `redact_client_log_data`
- `replica_set_scaling_strategy`
- `termination_protection_enabled`
- `version_release_system`

This means:
- If you don't configure these attributes, they won't appear in state
- Atlas still applies its default values server-side
- Use the data source to query actual values if needed

**Benefit:** Cleaner plan output - only shows actual changes you're making, not every computed value.
